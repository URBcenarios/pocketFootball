<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2e8b57">

    <title>Pocket Football</title>
    <style>
        body { margin: 0; background-color: #222; overflow: hidden; font-family: sans-serif; touch-action: none; user-select: none; -webkit-user-select: none; }
        canvas { display: block; margin: 0 auto; background: #2e8b57; }

        /* Placar */
        #hud {
            position: absolute; top: 10px; left: 0; width: 100%;
            display: flex; justify-content: center; gap: 20px;
            color: white; font-weight: bold; font-size: 24px;
            text-shadow: 1px 1px 2px black; pointer-events: none;
            z-index: 5;
        }
        .blue { color: #55f; }
        .red { color: #f55; }

        /* Aviso de Estado (Ataque/Defesa) */
        #status-msg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 40px; color: yellow; font-weight: 900;
            text-shadow: 0 0 10px black; opacity: 0; pointer-events: none;
            transition: opacity 0.5s; z-index: 10;
        }

        /* Controles */
        #controls {
            position: absolute; bottom: 20px; width: 100%; height: 160px;
            pointer-events: auto; display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box;
        }

        /* D-Pad */
        #dpad-area {
            width: 140px; height: 140px; background: rgba(255,255,255,0.1);
            border-radius: 50%; position: relative; border: 2px solid rgba(255,255,255,0.3);
        }
        #dpad-stick {
            width: 50px; height: 50px; background: rgba(255,255,255,0.5);
            border-radius: 50%; position: absolute; top: 45px; left: 45px;
            box-shadow: 0 0 10px black;
        }

        /* Botões de Ação */
        #actions {
            display: flex; gap: 20px; align-items: flex-end; padding-bottom: 10px;
        }
        .btn {
            width: 70px; height: 70px; border-radius: 50%;
            color: white; font-weight: bold; font-size: 14px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 0 rgba(0,0,0,0.5); border: 2px solid white;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        #btn-shoot { background: #e74c3c; } /* Vermelho - Chute/Carrinho */
        #btn-pass { background: #3498db; }  /* Azul - Passe/Troca */

    </style>
</head>
<body>

    <div id="hud">
        <span class="blue" id="scoreBlue">0</span> x <span class="red" id="scoreRed">0</span>
    </div>

    <div id="status-msg">ATAQUE</div>

    <canvas id="gameCanvas"></canvas>

    <div id="controls">
        <div id="dpad-area">
            <div id="dpad-stick"></div>
        </div>
        <div id="actions">
            <div class="btn" id="btn-pass">PASSE</div>
            <div class="btn" id="btn-shoot">CHUTE</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const statusEl = document.getElementById('status-msg');
        const scoreBlueEl = document.getElementById('scoreBlue');
        const scoreRedEl = document.getElementById('scoreRed');

        // Botões (Labels mudam)
        const btnPass = document.getElementById('btn-pass');
        const btnShoot = document.getElementById('btn-shoot');

        let width, height;

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- CONSTANTES ---
        const PLAYER_R = 15;
        const BALL_R = 8;
        const GOAL_W = 120;
        const FRICTION = 0.96;
        const SPEED = 4;
        const SHOOT_POWER = 12;
        const PASS_POWER = 8;

        // --- ESTADO DO JOGO ---
        let scoreBlue = 0;
        let scoreRed = 0;
        let possession = 'blue'; // Quem tem a bola (estado global)

        // --- OBJETOS ---
        const ball = { x: 0, y: 0, vx: 0, vy: 0, owner: null };

        // Jogadores: id 0=User, 1=Teammate | 2=Enemy1, 3=EnemyGK
        let players = [];

        function initGame() {
            // Posição inicial (Meio campo)
            resetPositions('attack');
        }

        function resetPositions(mode) {
            possession = (mode === 'attack') ? 'blue' : 'red';

            // Labels dos botões
            if(mode === 'attack') {
                btnPass.innerText = "PASSE";
                btnShoot.innerText = "CHUTE";
                showMessage("ATAQUE");
            } else {
                btnPass.innerText = "SPRINT"; // Simplificado: Corre mais
                btnShoot.innerText = "CARRINHO";
                showMessage("DEFESA");
            }

            // Define posições baseadas no modo
            // Time Azul (User)
            players[0] = { x: width/2, y: height/2 + 50, team: 'blue', role: 'user', slideTimer: 0 };
            players[1] = { x: width/2 - 80, y: height/2 + 80, team: 'blue', role: 'cpu', slideTimer: 0 };

            // Time Vermelho (CPU)
            players[2] = { x: width/2, y: height/2 - 50, team: 'red', role: 'cpu', slideTimer: 0 }; // Zagueiro
            players[3] = { x: width/2, y: 30, team: 'red', role: 'gk', slideTimer: 0 }; // Goleiro

            // Bola começa com quem tem a posse
            ball.vx = 0; ball.vy = 0;
            if (possession === 'blue') {
                ball.x = players[0].x;
                ball.y = players[0].y + 10;
                ball.owner = players[0];
            } else {
                // Defesa: CPU começa atacando de cima pra baixo
                players[2].y = 100; // CPU sobe
                players[0].y = height - 150; // User recua
                ball.x = players[2].x;
                ball.y = players[2].y + 10;
                ball.owner = players[2];
            }
        }

        function showMessage(text) {
            statusEl.innerText = text;
            statusEl.style.opacity = 1;
            setTimeout(() => statusEl.style.opacity = 0, 1500);
        }

        // --- INPUTS (JOYSTICK) ---
        let joystick = { active: false, x: 0, y: 0, angle: 0, mag: 0 };
        let keys = { pass: false, shoot: false };

        const dpadArea = document.getElementById('dpad-area');
        const stick = document.getElementById('dpad-stick');

        // Touch Joystick
        dpadArea.addEventListener('touchstart', startJoy, {passive: false});
        dpadArea.addEventListener('touchmove', moveJoy, {passive: false});
        dpadArea.addEventListener('touchend', endJoy);

        function startJoy(e) { e.preventDefault(); handleJoy(e.touches[0]); }
        function moveJoy(e) { e.preventDefault(); handleJoy(e.touches[0]); }
        function handleJoy(touch) {
            const rect = dpadArea.getBoundingClientRect();
            const centerX = rect.left + rect.width/2;
            const centerY = rect.top + rect.height/2;

            let dx = touch.clientX - centerX;
            let dy = touch.clientY - centerY;

            const dist = Math.sqrt(dx*dx + dy*dy);
            const maxDist = 35;

            // Angulo
            joystick.angle = Math.atan2(dy, dx);

            // Clamp distance
            if (dist > maxDist) {
                dx = Math.cos(joystick.angle) * maxDist;
                dy = Math.sin(joystick.angle) * maxDist;
            }

            stick.style.transform = `translate(${dx}px, ${dy}px)`;

            joystick.active = true;
            joystick.x = dx / maxDist; // Normalizado -1 a 1
            joystick.y = dy / maxDist;
            joystick.mag = dist / maxDist;
        }

        function endJoy() {
            joystick.active = false;
            joystick.x = 0; joystick.y = 0; joystick.mag = 0;
            stick.style.transform = `translate(0px, 0px)`;
        }

        // Botões Touch
        const bindBtn = (el, key) => {
            el.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            el.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
        };
        bindBtn(btnPass, 'pass');
        bindBtn(btnShoot, 'shoot');

        // --- FÍSICA E LÓGICA ---
        function dist(o1, o2) {
            return Math.sqrt((o1.x-o2.x)**2 + (o1.y-o2.y)**2);
        }

        function update() {
            // 1. Mover Bola
            if (!ball.owner) {
                ball.x += ball.vx;
                ball.y += ball.vy;
                ball.vx *= FRICTION;
                ball.vy *= FRICTION;

                // Colisão bola com laterais
                if(ball.x < BALL_R || ball.x > width - BALL_R) ball.vx *= -1;
                if(ball.y < BALL_R || ball.y > height - BALL_R) ball.vy *= -1;
            } else {
                // Bola grudada no dono
                ball.x = ball.owner.x + Math.cos(ball.owner.angle || 0) * 10;
                ball.y = ball.owner.y + Math.sin(ball.owner.angle || 0) * 10;
                ball.vx = 0; ball.vy = 0;
            }

            // 2. Mover Jogadores
            players.forEach(p => {
                // Carrinho (Slide)
                if (p.slideTimer > 0) {
                    p.slideTimer--;
                    // Move rápido na direção atual
                    p.x += Math.cos(p.angle) * SPEED * 1.5;
                    p.y += Math.sin(p.angle) * SPEED * 1.5;
                    return; // Não controla enquanto desliza
                }

                if (p.role === 'user') {
                    // Controle do Usuário
                    if (joystick.active) {
                        p.x += joystick.x * SPEED;
                        p.y += joystick.y * SPEED;
                        p.angle = joystick.angle;
                    }

                    // Ações
                    if (possession === 'blue') {
                        // ATAQUE
                        if (keys.shoot && ball.owner === p) {
                            // Chute
                            ball.owner = null;
                            ball.vx = Math.cos(p.angle) * SHOOT_POWER;
                            ball.vy = Math.sin(p.angle) * SHOOT_POWER;
                            keys.shoot = false; // Reset instantâneo
                        } else if (keys.pass && ball.owner === p) {
                            // Passe para o teammate
                            let mate = players[1];
                            let angleToMate = Math.atan2(mate.y - p.y, mate.x - p.x);
                            ball.owner = null;
                            ball.vx = Math.cos(angleToMate) * PASS_POWER;
                            ball.vy = Math.sin(angleToMate) * PASS_POWER;
                            keys.pass = false;
                        }
                    } else {
                        // DEFESA
                        if (keys.shoot) { // Botão Vermelho = Carrinho
                            p.slideTimer = 20; // Frames deslizando
                            keys.shoot = false;
                        }
                    }

                } else if (p.role === 'cpu') {
                    // IA Simples
                    let targetX, targetY;

                    if (p.team === 'red') {
                        // INIMIGO
                        if (possession === 'red') {
                             // Atacando (Tenta chegar no fundo)
                             targetX = width/2;
                             targetY = height + 50;
                             // Desvia do player azul? (Simples: vai reto)
                        } else {
                            // Defendendo (Persegue a bola)
                            targetX = ball.x;
                            targetY = ball.y;
                        }
                    } else {
                        // TEAMMATE (Azul)
                        // Acompanha o ataque mas fica aberto
                        targetX = ball.x + 60;
                        targetY = ball.y - 40;
                    }

                    // Move IA
                    let dx = targetX - p.x;
                    let dy = targetY - p.y;
                    let d = Math.sqrt(dx*dx + dy*dy);
                    if (d > 5) {
                        p.x += (dx/d) * (SPEED * 0.9); // IA um pouco mais lenta
                        p.y += (dy/d) * (SPEED * 0.9);
                        p.angle = Math.atan2(dy, dx);
                    }
                } else if (p.role === 'gk') {
                    // GOLEIRO
                    // Segue a bola apenas no eixo X
                    let targetX = ball.x;
                    if (targetX < width/2 - GOAL_W/2) targetX = width/2 - GOAL_W/2;
                    if (targetX > width/2 + GOAL_W/2) targetX = width/2 + GOAL_W/2;

                    let dx = targetX - p.x;
                    p.x += dx * 0.1; // Lerp suave

                    // Sai do gol se bola estiver muito perto
                    if (ball.y < 100 && !ball.owner) {
                        let dy = ball.y - p.y;
                        p.y += dy * 0.1;
                    } else {
                        p.y += (30 - p.y) * 0.1; // Volta pro gol
                    }
                }

                // Limites do campo
                if(p.x < 0) p.x = 0; if(p.x > width) p.x = width;
                if(p.y < 0) p.y = 0; if(p.y > height) p.y = height;

                // Roubada de bola / Posse
                if (!ball.owner && dist(p, ball) < PLAYER_R + BALL_R) {
                    // Quem pegar leva
                    ball.owner = p;
                    // Se a posse mudou (roubada de bola)
                    if (possession !== p.team) {
                        possession = p.team;
                        // Troca instantânea de estado visual
                        if(possession === 'blue') showMessage("ROUBOU!");
                        else showMessage("PERDEU!");

                        // Atualiza botões
                        if(p.team === 'blue') {
                            btnPass.innerText = "PASSE"; btnShoot.innerText = "CHUTE";
                        } else {
                            btnPass.innerText = "SPRINT"; btnShoot.innerText = "CARRINHO";
                        }
                    }
                }

                // Carrinho acerta adversário com bola
                if (p.slideTimer > 0 && ball.owner && ball.owner.team !== p.team) {
                     if (dist(p, ball.owner) < PLAYER_R * 2) {
                         // TACKLE BEM SUCEDIDO
                         let victim = ball.owner;
                         ball.owner = null; // Bola solta
                         // Bola espirra longe
                         ball.vx = Math.cos(p.angle) * 10;
                         ball.vy = Math.sin(p.angle) * 10;
                         // Atordoa vítima? (Opcional, não implementado pra ser simples)
                     }
                }
            });

            // 3. Checar GOL ou BOLA FORA
            // GOL NO TOPO (Ataque Azul)
            if (ball.y < 5 && ball.x > width/2 - GOAL_W/2 && ball.x < width/2 + GOAL_W/2) {
                scoreBlue++;
                scoreBlueEl.innerText = scoreBlue;
                showMessage("GOL AZUL!");
                setTimeout(() => resetPositions('attack'), 2000); // Quem faz, ataca
                ball.y = -100; // Tira da tela pra nao contar duplo
            }
            // GOL EM BAIXO (Ataque Vermelho - cruzou a linha)
            else if (ball.y > height && ball.x > width/2 - GOAL_W/2 && ball.x < width/2 + GOAL_W/2) {
                // Se o vermelho entrar com bola no gol de baixo
                scoreRed++;
                scoreRedEl.innerText = scoreRed;
                showMessage("GOL CPU!");
                setTimeout(() => resetPositions('defense'), 2000);
                ball.y = height + 100;
            }
            // BOLA SAIU PELA LINHA DE FUNDO (TIRO DE META)
            else if (ball.y < 0 || ball.y > height) {
                // Se foi Azul atacando e errou -> Vira Defesa
                if (possession === 'blue' && ball.y < 0) {
                    showMessage("FORA!");
                    setTimeout(() => resetPositions('defense'), 1500);
                }
                // Se foi CPU atacando e errou -> Vira Ataque
                else if (possession === 'red' && ball.y > height) {
                    showMessage("TIRO DE META");
                    setTimeout(() => resetPositions('attack'), 1500);
                }
                ball.y = -999; ball.vx=0; ball.vy=0;
            }
        }

        function draw() {
            // Gramado
            ctx.fillStyle = "#2e8b57";
            ctx.fillRect(0, 0, width, height);

            // Linhas
            ctx.strokeStyle = "rgba(255,255,255,0.5)";
            ctx.lineWidth = 3;

            // Grande área (Topo)
            ctx.strokeRect(width/2 - 100, 0, 200, 100);
            // Meio campo (Base)
            ctx.beginPath();
            ctx.moveTo(0, height/2); ctx.lineTo(width, height/2);
            ctx.stroke();
            // Círculo central
            ctx.beginPath();
            ctx.arc(width/2, height/2, 50, 0, Math.PI*2);
            ctx.stroke();

            // Gol Topo
            ctx.fillStyle = "rgba(0,0,0,0.2)";
            ctx.fillRect(width/2 - GOAL_W/2, 0, GOAL_W, 40);
            ctx.strokeStyle = "white";
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(width/2 - GOAL_W/2, 0); ctx.lineTo(width/2 - GOAL_W/2, 40); ctx.lineTo(width/2 + GOAL_W/2, 40); ctx.lineTo(width/2 + GOAL_W/2, 0);
            ctx.stroke();

            // Jogadores
            players.forEach(p => {
                // Sombra
                ctx.fillStyle = "rgba(0,0,0,0.3)";
                ctx.beginPath(); ctx.arc(p.x+2, p.y+5, PLAYER_R, 0, Math.PI*2); ctx.fill();

                // Corpo
                ctx.fillStyle = (p.team === 'blue') ? "#3498db" : (p.role === 'gk' ? "#f1c40f" : "#e74c3c");
                ctx.beginPath(); ctx.arc(p.x, p.y, PLAYER_R, 0, Math.PI*2); ctx.fill();

                // Indicador (Borda branca se for User)
                if (p.role === 'user') {
                    ctx.strokeStyle = "white"; ctx.lineWidth = 2;
                    ctx.beginPath(); ctx.arc(p.x, p.y, PLAYER_R, 0, Math.PI*2); ctx.stroke();
                }

                // Indicador de Posse
                if (ball.owner === p) {
                    ctx.strokeStyle = "yellow"; ctx.lineWidth = 2;
                    ctx.beginPath(); ctx.arc(p.x, p.y, PLAYER_R + 5, 0, Math.PI*2); ctx.stroke();
                }
            });

            // Bola
            if (!ball.owner) { // Só desenha bola solta se não tiver dono (senão fica "dentro" do pé)
                ctx.fillStyle = "rgba(0,0,0,0.3)";
                ctx.beginPath(); ctx.arc(ball.x+2, ball.y+2, BALL_R, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = "white";
                ctx.beginPath(); ctx.arc(ball.x, ball.y, BALL_R, 0, Math.PI*2); ctx.fill();
                // Detalhe bola (gomos)
                ctx.strokeStyle = "black"; ctx.lineWidth = 1;
                ctx.beginPath(); ctx.arc(ball.x, ball.y, BALL_R, 0, Math.PI*2); ctx.stroke();
            } else {
                // Desenha bola no pé do jogador
                let bx = ball.owner.x + Math.cos(ball.owner.angle||0)*12;
                let by = ball.owner.y + Math.sin(ball.owner.angle||0)*12;
                ctx.fillStyle = "white";
                ctx.beginPath(); ctx.arc(bx, by, BALL_R, 0, Math.PI*2); ctx.fill();
            }
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        initGame();
        loop();

    </script>
</body>
</html>
